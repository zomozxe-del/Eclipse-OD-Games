<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Apps — Eclipse Games</title>
    <link rel="stylesheet" href="assets/css/site.css">
</head>

<body>
    <canvas id="bgCanvas"></canvas>

    <nav class="nav-tabs">
        <div class="nav-tabs-left">
            <a href="index.html">Home</a>
            <a href="games.html">Games</a>
            <a href="apps.html" class="active">Apps</a>
            <a href="settings.html">Settings</a>
        </div>
    </nav>

    <div class="games-container">
        <div class="games-title-corner">
            <h1>Apps</h1>
        </div>

        <div class="games-controls">
            <!-- No loader needed for apps right now -->
        </div>

        <div class="games-panel">
            <section class="games-grid" id="appsGrid" aria-live="polite">
                <!-- Our 3 New Integrated Web Apps -->
                <a class="card"
                    style="background-image: url('https://cdn.vectorstock.com/i/preview-1x/17/96/realistic-popcorn-cinema-movie-watching-concept-vector-39051796.jpg'); cursor: pointer;"
                    href="movies.html">
                    <div class="title"
                        style="text-shadow: -1px -1px 0 #000, 1px -1px 0 #000, -1px 1px 0 #000, 1px 1px 0 #000;">Eclipse
                        Movies</div>
                </a>
                <a class="card"
                    style="background-image: url('https://chatgpt.com/backend-api/estuary/content?id=file_0000000040b071fd95694741935dddbc&ts=492215&p=fs&cid=1&sig=746fb583cb5c85d13edf3f18e359a3d15c2891cb49393b0544c415b5273fbb79&v=0'); cursor: pointer;"
                    href="shows.html">
                    <div class="title"
                        style="text-shadow: -1px -1px 0 #000, 1px -1px 0 #000, -1px 1px 0 #000, 1px 1px 0 #000;">Eclipse
                        Shows</div>
                </a>
            </section>
        </div>
    </div>

    <!-- App Panel Overlay -->
    <div class="game-panel-overlay" id="appPanelOverlay"></div>
    <div class="game-panel" id="appPanel">
        <div class="game-panel-content">
            <div class="game-panel-loader" id="appPanelLoader">
                <div class="loader" style="border: 3px solid rgba(255,255,255,0.1); border-top: 3px solid #ffffff;">
                </div>
                <div style="color: #ffffff; font-size: 14px; margin-top: 16px;">Loading app...</div>
            </div>
            <iframe id="appFrame" src=""
                allow="autoplay *; fullscreen *; accelerometer *; camera *; gyroscope *; magnetometer *; microphone *; usb *; xr-spatial-tracking *"></iframe>
        </div>
        <div class="game-panel-header">
            <h2 class="game-panel-title" id="appPanelTitle">App</h2>
            <button class="game-panel-close" id="appPanelClose">&times;</button>
        </div>
    </div>

    <script>
        const settings = {
            animationEnabled: localStorage.getItem('animationEnabled') !== 'false',
            theme: localStorage.getItem('theme') || 'theme-bw',
            particleType: localStorage.getItem('particleType') || 'snow'
        };

        document.body.classList.add(settings.theme);
        if (!settings.animationEnabled) {
            document.body.classList.add('animations-disabled');
        } else {
            (function () {
                const canvas = document.getElementById('bgCanvas');
                const ctx = canvas.getContext('2d');
                let W = canvas.width = innerWidth, H = canvas.height = innerHeight;
                window.addEventListener('resize', () => { W = canvas.width = innerWidth; H = canvas.height = innerHeight; });
                const type = settings.particleType;

                if (type === 'snow') {
                    const flakes = Array.from({ length: 120 }, () => ({ x: Math.random() * W, y: Math.random() * H, r: Math.random() * 3 + 1, d: Math.random() }));
                    let a = 0;
                    (function draw() { ctx.clearRect(0, 0, W, H); ctx.fillStyle = 'rgba(255,255,255,0.85)'; ctx.beginPath(); for (const f of flakes) { ctx.moveTo(f.x, f.y); ctx.arc(f.x, f.y, f.r, 0, Math.PI * 2); } ctx.fill(); a += 0.01; for (const f of flakes) { f.y += Math.pow(f.d, 2) + 0.8; f.x += Math.sin(a) * 0.4; if (f.y > H) { f.y = 0; f.x = Math.random() * W; } } requestAnimationFrame(draw); })();
                } else if (type === 'stars') {
                    const s = Array.from({ length: 180 }, () => ({ x: Math.random() * W, y: Math.random() * H, r: Math.random() * 1.6 + 0.3, tw: Math.random() * Math.PI * 2, sp: Math.random() * 0.015 + 0.003 }));
                    (function draw() { ctx.clearRect(0, 0, W, H); for (const st of s) { st.tw += st.sp; ctx.beginPath(); ctx.arc(st.x, st.y, st.r, 0, Math.PI * 2); ctx.fillStyle = `rgba(255,255,255,${0.4 + 0.6 * Math.abs(Math.sin(st.tw))})`; ctx.fill(); } requestAnimationFrame(draw); })();
                } else if (type === 'rain') {
                    const d = Array.from({ length: 100 }, () => ({ x: Math.random() * W, y: Math.random() * H, len: Math.random() * 18 + 8, sp: Math.random() * 8 + 6 }));
                    (function draw() { ctx.clearRect(0, 0, W, H); ctx.strokeStyle = 'rgba(150,200,255,0.55)'; ctx.lineWidth = 1; for (const dr of d) { ctx.beginPath(); ctx.moveTo(dr.x, dr.y); ctx.lineTo(dr.x - 2, dr.y + dr.len); ctx.stroke(); dr.y += dr.sp; if (dr.y > H) { dr.y = -dr.len; dr.x = Math.random() * W; } } requestAnimationFrame(draw); })();
                } else if (type === 'bubbles') {
                    const b = Array.from({ length: 55 }, () => ({ x: Math.random() * W, y: H + Math.random() * H, r: Math.random() * 18 + 6, sp: Math.random() * 1.2 + 0.4, w: Math.random() * Math.PI * 2 }));
                    canvas.addEventListener('click', e => { const mx = e.clientX, my = e.clientY; for (const bub of b) { if (Math.hypot(mx - bub.x, my - bub.y) < bub.r + 10) { bub.y = H + bub.r; bub.x = Math.random() * W; } } });
                    (function draw() { ctx.clearRect(0, 0, W, H); for (const bub of b) { bub.w += 0.015; bub.y -= bub.sp; bub.x += Math.sin(bub.w) * 0.6; if (bub.y < -bub.r * 2) { bub.y = H + bub.r; bub.x = Math.random() * W; } ctx.beginPath(); ctx.arc(bub.x, bub.y, bub.r, 0, Math.PI * 2); ctx.strokeStyle = 'rgba(180,130,255,0.45)'; ctx.lineWidth = 1.5; ctx.stroke(); const g = ctx.createRadialGradient(bub.x - bub.r * .3, bub.y - bub.r * .3, 1, bub.x, bub.y, bub.r); g.addColorStop(0, 'rgba(220,190,255,0.12)'); g.addColorStop(1, 'rgba(160,80,255,0.04)'); ctx.fillStyle = g; ctx.fill(); } requestAnimationFrame(draw); })();
                } else if (type === 'embers') {
                    const e = Array.from({ length: 90 }, () => ({ x: Math.random() * W, y: H + Math.random() * H, r: Math.random() * 2.5 + 0.5, sp: Math.random() * 2 + 0.8, w: Math.random() * Math.PI * 2, l: Math.random() }));
                    (function draw() { ctx.clearRect(0, 0, W, H); for (const em of e) { em.w += 0.04; em.y -= em.sp; em.x += Math.sin(em.w) * 1.1; em.l -= 0.003; if (em.y < 0 || em.l <= 0) { em.y = H; em.x = Math.random() * W; em.l = 1; } ctx.beginPath(); ctx.arc(em.x, em.y, em.r, 0, Math.PI * 2); ctx.fillStyle = `rgba(255,${Math.floor(100 + 80 * em.l)},20,${Math.max(0, em.l)})`; ctx.fill(); } requestAnimationFrame(draw); })();
                } else if (type === 'matrix') {
                    const fs = 14, cols = Math.floor(W / fs), drops = Array(cols).fill(1);
                    const chars = 'アイウエオカキクケコ01ﾊﾋﾌﾍﾎ'.split('');
                    let frame = 0;
                    (function draw() { frame++; if (frame % 3 !== 0) { requestAnimationFrame(draw); return; } ctx.fillStyle = 'rgba(0,0,0,0.07)'; ctx.fillRect(0, 0, W, H); ctx.fillStyle = '#0f0'; ctx.font = fs + 'px monospace'; for (let i = 0; i < drops.length; i++) { ctx.fillText(chars[Math.floor(Math.random() * chars.length)], i * fs, drops[i] * fs); if (drops[i] * fs > H && Math.random() > 0.975) drops[i] = 0; drops[i]++; } requestAnimationFrame(draw); })();
                } else if (type === 'grid') {
                    let mx = -999, my = -999;
                    window.addEventListener('mousemove', e => { mx = e.clientX; my = e.clientY; });
                    const CELL = 40;
                    (function draw() { ctx.clearRect(0, 0, W, H); const cols2 = Math.ceil(W / CELL) + 1, rows = Math.ceil(H / CELL) + 1; for (let r = 0; r < rows; r++) { for (let c = 0; c < cols2; c++) { const cx = c * CELL, cy = r * CELL, dist = Math.hypot(cx - mx, cy - my), glow = Math.max(0, 1 - dist / 180); ctx.strokeStyle = `rgba(${80 + Math.round(glow * 175)},${80 + Math.round(glow * 175)},${80 + Math.round(glow * 175)},${0.18 + glow * 0.55})`; ctx.lineWidth = 0.5 + glow * 1.5; ctx.strokeRect(cx, cy, CELL, CELL); } } requestAnimationFrame(draw); })();
                } else if (type === 'banner') {
                    document.body.classList.add('banner-bg');
                    canvas.style.display = 'none';
                } else if (type === 'none') {
                    canvas.style.display = 'none';
                }
            })();
        }

        /* ========= APP PANEL CONTROLS ========= */
        const appPanelClose = document.getElementById('appPanelClose');
        const appPanelOverlay = document.getElementById('appPanelOverlay');

        function openAppPanel(appName, appUrl) {
            const panel = document.getElementById('appPanel');
            const overlay = document.getElementById('appPanelOverlay');
            const title = document.getElementById('appPanelTitle');
            const frame = document.getElementById('appFrame');
            const loader = document.getElementById('appPanelLoader');

            title.textContent = appName;

            // Show loader
            loader.classList.remove('hidden');

            // Set iframe src
            frame.src = appUrl;

            // Hide loader when iframe loads
            frame.onload = function () {
                setTimeout(() => {
                    loader.classList.add('hidden');
                }, 300);
            };

            // Show panel
            panel.classList.add('active');
            overlay.classList.add('active');

            // Prevent body scroll when panel is open
            document.body.style.overflow = 'hidden';
        }

        function closeAppPanel() {
            const panel = document.getElementById('appPanel');
            const overlay = document.getElementById('appPanelOverlay');
            const frame = document.getElementById('appFrame');

            panel.classList.remove('active');
            overlay.classList.remove('active');
            frame.src = '';

            // Restore body scroll
            document.body.style.overflow = 'auto';
        }

        appPanelClose.addEventListener('click', closeAppPanel);
        appPanelOverlay.addEventListener('click', closeAppPanel);

        // Close panel with Escape key
        document.addEventListener('keydown', (e) => {
            if (e.key === 'Escape') {
                closeAppPanel();
            }
        });

    </script>
</body>

</html>